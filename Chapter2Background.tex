\chapter{Background} \label{background}
    \blindtext
    
    \longsection{PET}{pet}
        \blindtext
        % general intro
        
        \subsection{The Physics of PET} \label{the_physics_of_pet}
            % write something about radiotracer, functional imaging, radiounclide decays, and photon interaction with matter
            
            \gls{PET} is an example of a type of imaging known as functional imaging. It is functional as rather than capturing images of anatomy for instance the structure and density of bones, it images the metabolic processes of a living thing. This metabolic function is, for instance, how blood flows through and into parts of the body (perfusion) or how glucose is transported to and metabolised by certain cells.
            
            The process through which a \gls{PET} scan takes place is as follows; firstly, a patient is injected with a chemical compound called a radiotracer which is a solution containing radionuclides. A radiotracer is a biologically active molecule which has been labelled with a positron emitting radionuclide. The molecule will have been selected knowing that it will have significant uptake in the \gls{ROI} depending on the target tissue. In other words, after perfusion (through the circulatory system) it will appear with a greater frequency within certain types of cells (post metabolistation). The positron emitting radionuclide is selected because it has the capacity to be labelled to the molecule by replacing one of its groups, not all radionuclides can be labelled to all molecules. % After injection the radiotracer perfuses through the circulatory system of the patient.
            
            Some examples of common radionuclides used in radiotracers include; fluorine $18$, gallium $67$, gallium $68$, and rubidium $82$. The rate at which a radionuclide decays is measured in terms of half life. The half-life is defined as the amount of time for which the number of atoms of a radioactive material reduces by half. Half lives for various radioisotopes can range from a few microseconds to billions years. For the examples above these half lifes are approximately; $110$ minutes, $67$ minutes and $1.1$ minutes respectively~\boxcite{FDGGuidelines}.
            
            An example of the use of some of these radionuclides are:
            
            \begin{itemize}
                \item Glucose molecules can be labelled with fluorine $18$ (called \gls{FDG}). Glucose is used by cells, though glycolosis, in the carbohydrate metabolisation process to produce \gls{ATP} to make energy available to a cell. When a cell requires more energy it also requires more glucose and as such uptaken of \gls{FDG} is increased in these regions. Fluorine $18$ collects, over time, intra-cellularly because fluorine $18$ labelled \gls{FDG} cannot be fully metabolised due to the group which is replaced by fluorine $18$ being missing and required for this process. Thus the distribution of fluorine $18$ is a good reflection of glucose metabolisation and uptake over time. \gls{FDG} is by far the most commonly used radiotracer in \gls{PET}~\boxcite{WeissBook, FDGGuidelines}.
                
                \item Gallium $67$ and gallium $68$ are often used to target \gls{PSMA} which can be used in the detection of prostate cancer. \gls{PSMA} is a protein which is present in prostate cancer cells.
                
                \item Rubidium $82$ can be used to image the heart in a scan targeting myocardial perfusion~\boxcite{Selwyn1982}.
            \end{itemize}
            
            Radionucleides used in \gls{PET} undergo a type of decay called $\beta-$decay~\boxcite{conti_beta}. This is due to an instability of the radionuclide, given to an imbalance of neutrons to protons. As a consequence, a proton in its nucleus converts into a neutron releasing a positron and a neutrino. The emitted positron travels with some decreasing velocity, from sequential collisions, through the body of the patient, for a distance called positron range, before its final collision and annihilation with its antiparticle the electron~\boxcite{EvansPositronBib}. A \gls{PET} scanner thus does not image, directly, the emission of the positron but, in fact, more closely images the location of the annihilation.
            
            The annihilation causes the emission of two $511$ \gls{KeV} gamma photons at $180^{\circ}$ apart from one another. However, because the poistron-electron pair may not be at rest at the moment of their annihilation, the two emitted photons can show a certain degree of non-collinearity, according to the laws of conservation of energy and momentum. This means that the gamma photons are never exactly $180^{\circ}$ apart~\boxcite{pet_basic}.%, because the positron will usually have a small kinetic energy going into the annihilation. This kinetic energy is conserved after the annihilation as a force in a different direction, usually, to that of the force from the annihilation itself.
            
            The \gls{FOV} of the scanner is the area in which it can detect these gamma photons. Current clinical \gls{PET} scanners, usually, have a cylindrical \gls{FOV} with a length of between $15$ and $25$ centimetres and a diameter of between $50$ and $70$ centimetres~\boxcite{Pan2019}. In order to take acquire data over an area of more than the length of the scanner acquisitions can be taken over multiple positions and summed together. Alternatively, whole body \gls{PET} scanners are becoming more viable for research and have a high potential for clinical applications. However, the increased price and size constitute a limitation. Whole body \gls{PET} scanners have an axial \gls{FOV} which contains most of the patients body making multiple acquisitions less necessary while also increasing the sensitivity to detecting annihilations~\boxcite{Cherry2018}.
            
            \subsubsection{Static and Dynamic Acquisition} \label{static_and_dynamic_acquisition}
                There are two main types of \gls{PET} scan useful for determining separate processes, these types of scans and uses are:
                
                \begin{itemize}
                    \item The first and most common type of \gls{PET} scan is a static \gls{PET} scan. The patient is scanned only when the injected radiotracer has perfused through their body and eventually stabilised at a semi-consistent distribution. The time elapsed between injection and acquisition depends on the half life and metabolisation of the radiotracer. For \gls{FDG} about $60$ minutes is given.
                    
                    \item The second type of \gls{PET} scan is a dynamic scan. The acquisition begins before the radiotracer is injected into the patient. The injection of the radiotracer during the acquisition allows for the kinetics of the tracer to be observed and quantified with the use of compartmental modelling~\boxcite{Lammertsma2017}. For example, from direct parametric reconstruction in dynamic \gls{PET} \gls{MPI}: in-vivo studies used in conjunction with tracer kinetic modelling enables the quantification of \gls{MBF}. Radiotracers such as rubidium $82$ are particularly indicated for dynamic scans given their short half life~\ref{the_physics_of_pet}.
                \end{itemize}
            
            \subsubsection{Attenuation} \label{attenuation}
                Attenuation is the amount of counts lost from annihilation to detection by the scanner while the photons are traversing through the body of the patient. Attenuation can amount to a loss of up to $95$ percent of the total initial signal and can cause increased issues in larger bariatric patients who quite literally have more matter that the photons have to pass through increasing the likelihood that they will be scattered or otherwise attenuated~\boxcite{book, Essential2012}.
                
                There are $4$ main ways through which the photon signal can be lost~\boxcite{book2}, these are in ascending order of magnitude:
                
                \begin{itemize}
                    \item Pair production can be thought of as the inverse process compared to annihilation (as discussed above). This is where a subatomic particle and its antiparticle, such as a electron and a positron, are created from a fundamental particle, such as a photon, usually in close proximity to an atomic nucleus. However, because of conservation of energy a photon would need to be of at least $1.022$ \gls{MeV} which is not generally possible for photons created through electron positron annihilation.
                    
                    \item Rayleigh scattering is the elastic scattering of photons without loss of significant energy by particles which are much smaller than the wavelength of the photon. A common example of Rayleigh scattering is the scattering of sunlight in the atmosphere which is causes the blue colour of the sky during the day and the red colour of the sky at sunset. Because the wavelength of gamma photons is comparably small, compared to most particles, the probability of Rayleigh scattering occurring is negligible and thus it is normally ignored in \gls{PET}.
                    
                    \item Absorption through the photoelectric effect is the process through which the high energy gamma photon hits and transfers its energy to a material causing the emission of lower energy electrons. The likelihood of the photoelectric effect is inversely proportional to the cube of the photon energy; it also increases as the atomic number of the attenuating material increases. In the matter of the patient the photoelectric effect is most prevalent at photon energies below $100$ \gls{KeV} and as such the probability of the photoelectric effect occurring here is minimal~\boxcite{book}. Photoelectric effect occurs mostly in the detectors of the scanner.
                    
                    \item Compton scattering comprises the majority of interactions between the photon and matter, it occurs where the photon interacts with an electron in a close by atom. The recoiling electron causes the photon to be deflected along another path transferring energy from photon to electron. Compton scattering is also known as incoherent scattering because of its effect on trajectory of the photon. The probability of Compton scattering is indirectly proportional to the energy of the photon~\boxcite{book}.
                \end{itemize}
                
                The relationship between the attenuation of the signal and the material through which it is travelling is given by the Beer-Lambert law. Given $I_0$ incident photons travelling across a path of length $D$, the number of non-attenuated photons $\rmI_{\rmD}$ is given by:
                 
                \begin{equation} \label{eq:beer_lambert_law}
                    \rmI_{\rmD} := \rmI_{0} \cdot \exp\Bigg(\int_{\rmD} - \mu_E(r)\rmd r \Bigg)
                \end{equation}

                \noindent where $\mu_E(r)$ is the attenuation coefficient of the media crossed by the photons of energy $E$.
        
        \subsection{Data acquisition} \label{data_acquisition}
            % write a general intro on the scanner structure, and the type of events you detect (true scatter randoms etc)
            
            As discussed above~\ref{the_physics_of_pet}, the structure of a \gls{PET} scanner used to detect the gamma photons, emitted from within the patient, is that of concentric rings of detectors offset along a central axis by the width of the ring plus some small margin. These rings detect each incident photon and attempt to temporally and spatially link opposing photons along a \gls{LOR} through the scanner. The methods though which the scanner attempts to detect incident photons and then link relative photons together will be discussed in the following sections~\ref{photon_detection},~\ref{coincidence_processing}.
            
            Because of the photons interaction in matter~\ref{attenuation}, there are $4$ different types of event or prompts that can be detected by the scanner, these are:
            
            \begin{itemize}
                \item Firstly, the prompts that originate from the same annihilation event and pass through the body of the patient to the detector without being scattered or attenuated. These prompts are called true coincidences as they approximately accurately reflect the position of the originating annihilation.
                
                \item Secondly, there are prompts, which may have originated from the same annihilation event but, from which $1$ or more of the incident photons has undergone Compton scattering before detection. These prompts are called scattered coincidences.
                
                \item Thirdly, there are prompts where the \gls{LOR} is determined from $2$ photons from $2$ distinct annihilation events, thus the \gls{LOR} does not reflect an actual annihilation in reality. This could occur because $1$ or more of the photons, from the original pair of photons, may have been attenuated or scattered so that it does not arrive at the detector within a reasonable time of its photon pair. These are called random coincidences.
                
                \item Fourthly, there could be a situation where $3$ or more photons are detected within close temporal proximity to one another. Because of the close time of detection, in this case it is not possible to determine which photons reflect an actual annihilation and which are random coincidences. These prompts could be called multiple coincidences.
            \end{itemize}
            
            The total prompts detected during a \gls{PET} acquisition $P$ can be expressed as:
            
            \begin{equation}
                P := T + S + R
            \end{equation}
            
            \noindent where $T$ is the number of true coincidences, $S$ is the number of scattered coincidences and $R$ is the number of random coincidences. Thus the usual total sum of scattered and random coincidences when compared to true coincidences is a ratio of $2$ to $1$.
            
            \subsubsection{2D and 3D Acquisition} \label{2d_and_3d_acquisition}
                There are $2$ different methods used in \gls{PET} to determine or constrain to be certain of the spatial position or angle of the \gls{LOR} along the axis of the scanner, these are:
                
                \begin{itemize}
                    \item The method which was used for a long time in other applications (such as \gls{SPECT}) and until recently in \gls{PET} was; to place a block of, usually, tungsten metal (for its photon absorbing properties) in front of all of the detectors, this block is called s septa. The septa has very small slits cut into it which would only allow photons to pass through which entered the slits at an acute angle. Thus the septa constrains the photons to being almost perpendicular to the detector (on axis) and as such each detector only receives signal from annihilations that occur within its ring. This process is called collimation and the subsequent acquisition is called a \gls{2D} acquisition, \gls{2D} not because it results in a single image but because it is comprised of distinct \gls{2D} projections.
                    
                    \item The more modern method is to simply remove the septa from the scanner and to record coincidences between all rings. This is significantly more computationally expensive than a \gls{2D} acquisition but it also increases the sensitivity of the scanner meaning that scanning times can be reduced. Because this method produces projections between all rings it is known as a \gls{3D} acquisition~\boxcite{Schmitz2013}.
                \end{itemize}
            
            \subsubsection{Photon Detection} \label{photon_detection}
                The actual composition of the detector used in the rings of the scanner is made up of $3$ components; a scintillator crystal, which through the photoelectric effect when exposed to ionising radiation produces visible light through luminescence, and a photodetector or photomultiplier which amplifies the intensity of an input light similarly to how a vacuum tube or a transistor would amplify an electrical signal.
                
                For use in \gls{PET} the following properties are desirable for a scintillator crystal:
                
                \begin{itemize}
                    \item Firstly, the crystal should have a high stopping power. This means that the photon does not travel a great distance into the crystal before it undergoes attenuation by the photoelectric effect. Usually the higher the density of the scintillator crystal the greater the stopping power.
                    
                    \item Secondly, for each incident photon the scintillator should have a high light output. This not only means that the work photomultiplier will have to amplify the output less but it also means that discriminating between scattered and unscattered photons will be easier as the discrepancy between the output intensity of the $2$ will be greater.
                    
                    \item Thirdly, the scintillator should return to a state where it can luminesce again rapidly after each incident photon. This means that more photons can be detected over time and that the exact moment a photon is attenuated can be better measured.
                    
                    \item Finally, a scintillator crystal should not be hygroscopic. To be hygroscopic means that something has a tendency to absorb water.
                \end{itemize}
                
                The first \gls{PET} scanners used \gls{NaI} scintillator crystals before moving to \gls{BGO} and then to \gls{LSO} and \gls{LYSO}. Each new generation of scintillator crystals provided a different balance of the above characteristics. \gls{LSO} and \gls{LYSO} have the best combination of efficiency and time resolution while not being hygroscopic~\boxcite{BGOCherenkovBib, ScintilatorsBib, Mao2013CrystalCrystals}.
                
                There are $3$ main types of photodetector or photomultiplier, these are:
                
                \begin{itemize}
                    \item The first kind of photodetector to be used in \gls{PET} was the \gls{PMT}, this device functions using an initial photocathode and a focusing electrode which takes the output from the scintillator and directs it towards a chain of dynodes. Dynodes are an intermediate electrode which when struck by a photoelectron emit more photoelectrons at a more positive electrical potential through secondary emission. Each subsequent dynode is a a higher potential and emits more photoelectrons than the last causing the input signal to be amplified. Some disadvantages of \gls{PMT} are that they are relatively bulky, are effected by a magnetic field and have a relatively low efficiency at approximately $25$ percent~\boxcite{book, SiPmBib}.
                    
                    \item To attempt to combat the low efficiency mentioned above the \gls{APD} was developed, this device utilises a semiconductor where there is a junction between positive and negative type silicone, this is similar to a traditional diode. This allows for efficiencies approaching $85$ percent, they are much smaller than \gls{PMT} and are safe to be used in a magnetic field. However, this also comes with the drawbacks that \gls{APD} produces so much heat that it requires an active cooling system and exhibits worse timing characteristics than the \gls{PMT}~\boxcite{AvalanchePhotodiodeBib}. \gls{APD} is the choice of many modern \gls{PET}/\gls{CT} scanners~\boxcite{Vandendriessche2019}.
                    
                    \item A further development on \gls{APD} gave \gls{SiPM} and \gls{SSPM}. These devices combine the benefits of both \gls{PMT} and \gls{APD} in that they have a high efficiency, small size, are safe to be used in a magnetic field and have good timing characteristic. \gls{SiPM} and \gls{SSPM} are becoming the new default photodetectors~\boxcite{SiPmBib}.
                \end{itemize}
            
            \subsubsection{Coincidence Processing} \label{coincidence_processing}
                \blindtext
                % write stuff about coincidence processing , give some info on TOF (or separate section for it, i don't know)
            
            \subsubsection{Data Output} \label{data_output}
                \blindtext
                % write stuff about coincidence processing , give some info on TOF (or separate section for it, i don't know)
            
            \subsubsection{Time of Flight PET} \label{tof_pet}
                \blindtext
            
            \subsubsection{PET resolution} \label{pet_resolution}
                \blindtext
            
        \subsection{Attenuation Correction} \label{attenuation_correction}
            \blindtext
            
                \subsubsection{Combined PET/CT} \label{combined_pet_ct}
                    \blindtext
    
    \longsection{PET Image Reconstruction}{pet_image_reconstruction}
        \blindtext
        
        \subsection{Analytic Image Reconstruction} \label{analytic_image_reconstruction}
            \blindtext
            % mention briefely FBP ?
        
        \subsection{Iterative Image Reconstruction} \label{iterative_image_reconstruction}
            \blindtext
            
            \subsubsection{Objective Function} \label{iterative_image_reconstruction_objective_function}
                \blindtext
                
            \subsubsection{Optimiser} \label{iterative_image_reconstruction_optimiser}
                \blindtext
    
    \longsection{Respiratory Motion in PET}{respiratory_motion_in_pet}
        \blindtext
        % general intro
        
        \subsection{Respiratory Motion Artefacts} \label{respiratory_motion_artefacts}
            \blindtext
            % have a look at https://www.sciencedirect.com/science/article/pii/S0001299808000214?via%3Dihub
            
        \subsection{Respiratory Motion Challenges in Combined PET/CT Imaging} \label{respiratory_motion_challenges_in_combined_pet_ct_imaging}
            \blindtext
            
            \subsubsection{Attenuation Correction Techniques in Respiratory Motion Correction} \label{attenuation_correction_techniques_in_respiratory_motion_correction}
                \blindtext
    
    \longsection{Motion Correction for PET}{motion_correction_for_pet}
        \blindtext
    
        \subsection{Image Registration} \label{image_registration}
            \blindtext
            
            \subsubsection{Objective Function} \label{image_registration_objective_function}
                \blindtext
                
            \subsubsection{Optimiser} \label{image_registration_optimiser}
                \blindtext
            
        \subsection{Respiratory Signal Detection} \label{respiratory_signal_detection}
            \blindtext
            
            \subsubsection{External Devices} \label{external_devices}
                \blindtext
                
            \subsubsection{Data Driven} \label{data_driven}
                \blindtext
                
        \subsection{Respiratory Gating} \label{respiratory_gating}
            \blindtext
            % brief intro
            
        \subsection{Motion Modelling} \label{motion_modelling}
            \blindtext
        
        \subsection{Applying Motion Correction} \label{applying_motion_correction}
            \blindtext
            
            \subsubsection{Post Image Reconstruction Motion Correction} \label{post_image_reconstruction_motion_correction}
                \blindtext
                
            \subsubsection{Iterative Motion Corrected Image Reconstruction} \label{iterative_motion_corrected_image_reconstruction}
                \blindtext
    
    \longsection{Machine Learning for PET}{machine_learning_for_pet}
        \blindtext
        
        \subsection{Machine Learning Concepts} \label{machine_learning_concepts}
            \blindtext
        
        \subsection{Machine Learning for PET Image Reconstruction} \label{machine_learning_for_pet_image_reconstruction}
            \blindtext
            % might want to mention this?
        
        \subsection{Machine Learning for Motion Correction} \label{machine_learning_for_motion_correction}
            \blindtext
